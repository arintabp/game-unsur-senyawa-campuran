<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kimia Catcher: DUEL EDITION</title>
    <style>
        body { margin: 0; overflow: hidden; background: #1e272e; font-family: 'Segoe UI', sans-serif; touch-action: none; }
        #gameCanvas { display: block; width: 100%; height: 100vh; }
        
        .ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 10; }
        
        /* Skor & Nyawa di atas masing-masing layar */
        .stats { position: absolute; top: 20px; width: 40%; display: flex; justify-content: space-between; color: white; font-weight: bold; font-size: 1.2em; text-shadow: 0 0 10px rgba(0,0,0,0.5); }
        #statsP1 { left: 5%; color: #74b9ff; }
        #statsP2 { right: 5%; color: #ff7675; }

        .modal { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.9); 
            display: flex; flex-direction: column; justify-content: center; align-items: center; 
            pointer-events: auto; z-index: 20; color: white; text-align: center;
        }
        .hidden { display: none !important; }
        
        .level-container { display: flex; gap: 10px; margin-top: 20px; }
        .lvl-btn {
            padding: 15px 25px; font-size: 1.2em; border: none; border-radius: 10px;
            color: white; cursor: pointer; font-weight: bold; transition: 0.2s; width: 80px;
        }
        .l1 { background: #00b894; } .l2 { background: #0984e3; } .l3 { background: #fdcb6e; color: #333; } .l4 { background: #e17055; } .l5 { background: #d63031; }

        .mute-btn { 
            position: absolute; top: 20px; left: 50%; transform: translateX(-50%);
            pointer-events: auto; cursor: pointer; background: rgba(255,255,255,0.1); 
            color: white; border-radius: 50%; width: 45px; height: 45px; border: 1px solid white; font-size: 1.2em; z-index: 30;
        }

        .divider { 
            position: absolute; left: 50%; top: 0; width: 4px; height: 100%; 
            background: rgba(255,255,255,0.2); transform: translateX(-50%); z-index: 5;
        }
    </style>
</head>
<body>

    <canvas id="gameCanvas"></canvas>
    <div class="divider"></div>

    <div class="ui-layer">
        <div id="statsP1" class="stats">
            <div>P1 ‚ú® <span id="scoreP1">0</span></div>
            <div>‚ù§Ô∏è <span id="livesP1">3</span></div>
        </div>
        <div id="statsP2" class="stats">
            <div>‚ù§Ô∏è <span id="livesP2">3</span></div>
            <div>P2 ‚ú® <span id="scoreP2">0</span></div>
        </div>
        <button class="mute-btn" onclick="toggleMute()">üîä</button>
    </div>

    <div id="startScreen" class="modal">
        <div style="font-size: 3em;">‚öîÔ∏è</div>
        <h1 style="font-size: 3em; margin: 0; color: #f1c40f;">KIMIA DUEL</h1>
        <p>Tangkap zat sesuai misi di sisi layar masing-masing!</p>
        <p style="font-size: 0.8em; color: #bdc3c7;">P1 (Kiri): Tombol A & D | P2 (Kanan): Tombol ‚¨ÖÔ∏è & ‚û°Ô∏è</p>
        <div class="level-container">
            <button class="lvl-btn l1" onclick="startGame(1)">1</button>
            <button class="lvl-btn l2" onclick="startGame(2)">2</button>
            <button class="lvl-btn l3" onclick="startGame(3)">3</button>
            <button class="lvl-btn l4" onclick="startGame(4)">4</button>
            <button class="lvl-btn l5" onclick="startGame(5)">5</button>
        </div>
    </div>

    <div id="gameOverScreen" class="modal hidden">
        <h1 id="winnerTitle" style="font-size: 3em;">PEMENANGNYA...</h1>
        <div style="display: flex; gap: 50px; margin: 20px 0;">
            <div>P1: <span id="finalScoreP1">0</span></div>
            <div>P2: <span id="finalScoreP2">0</span></div>
        </div>
        <button onclick="location.reload()" style="padding: 15px 40px; font-size: 1.5em; border-radius: 50px; background: #6c5ce7; color: white; border: none; cursor: pointer;">MAIN LAGI üîÑ</button>
    </div>

<script>
    const substances = [
        { name: "Emas", formula: "Au", type: "UNSUR", color: "#f1c40f" },
        { name: "Oksigen", formula: "O2", type: "UNSUR", color: "#00cec9" },
        { name: "Besi", formula: "Fe", type: "UNSUR", color: "#b2bec3" },
        { name: "Karbon", formula: "C", type: "UNSUR", color: "#636e72" },
        { name: "Helium", formula: "He", type: "UNSUR", color: "#ff7675" },
        { name: "Air", formula: "H2O", type: "SENYAWA", color: "#0984e3" },
        { name: "Garam", formula: "NaCl", type: "SENYAWA", color: "#dfe6e9" },
        { name: "Gula", formula: "C12..", type: "SENYAWA", color: "#fdcb6e" },
        { name: "CO2", formula: "Gas", type: "SENYAWA", color: "#a29bfe" },
        { name: "Cuka", formula: "Asam", type: "SENYAWA", color: "#e17055" },
        { name: "Udara", formula: "", type: "CAMPURAN", color: "#74b9ff" },
        { name: "Sirup", formula: "", type: "CAMPURAN", color: "#d63031" },
        { name: "Perunggu", formula: "", type: "CAMPURAN", color: "#e84393" },
        { name: "Tanah", formula: "", type: "CAMPURAN", color: "#8e44ad" },
        { name: "Susu", formula: "", type: "CAMPURAN", color: "#fff" }
    ];

    const targets = ["UNSUR", "SENYAWA", "CAMPURAN"];
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    
    let isPlaying = false;
    let currentLevel = 1;

    // --- PLAYER OBJECTS ---
    const p1 = { x: 0, y: 0, w: 120, h: 70, score: 0, lives: 3, target: "UNSUR", items: [], color: "#74b9ff", label: "P1", timer: 0 };
    const p2 = { x: 0, y: 0, w: 120, h: 70, score: 0, lives: 3, target: "SENYAWA", items: [], color: "#ff7675", label: "P2", timer: 0 };
    let particles = [];

    const AudioEngine = {
        ctx: new (window.AudioContext || window.webkitAudioContext)(),
        muted: false,
        playTone: function(f, t, d) { if(this.muted) return; const o = this.ctx.createOscillator(); const g = this.ctx.createGain(); o.type = t; o.frequency.value = f; g.gain.setValueAtTime(0.1, this.ctx.currentTime); g.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime+d); o.connect(g); g.connect(this.ctx.destination); o.start(); o.stop(this.ctx.currentTime+d); },
        playCorrect: function() { this.playTone(800, 'sine', 0.2); },
        playWrong: function() { this.playTone(150, 'sawtooth', 0.3); }
    };

    function resize() {
        canvas.width = window.innerWidth; canvas.height = window.innerHeight;
        p1.y = p2.y = canvas.height - 120;
        p1.x = (canvas.width / 4) - (p1.w / 2);
        p2.x = (canvas.width * 3/4) - (p2.w / 2);
    }
    window.addEventListener('resize', resize);
    resize();

    // --- CONTROLS ---
    const keys = {};
    window.addEventListener('keydown', e => keys[e.code] = true);
    window.addEventListener('keyup', e => keys[e.code] = false);

    canvas.addEventListener('touchmove', e => {
        e.preventDefault();
        for (let t of e.touches) {
            if (t.clientX < canvas.width / 2) moveBasket(p1, t.clientX, 0, canvas.width/2 - p1.w);
            else moveBasket(p2, t.clientX, canvas.width/2, canvas.width - p2.w);
        }
    }, { passive: false });

    function moveBasket(player, targetX, min, max) {
        let newX = targetX - (player.w / 2);
        if (newX < min) newX = min;
        if (newX > max) newX = max;
        player.x = newX;
    }

    function spawnItem(player, sideMin, sideMax) {
        const sub = substances[Math.floor(Math.random() * substances.length)];
        const size = 65;
        let baseSpeed = 0.5 + (currentLevel * 0.7) + (Math.random() * 0.5);
        player.items.push({ x: sideMin + Math.random() * (sideMax - sideMin - size), y: -80, size, data: sub, speed: baseSpeed });
    }

    function switchTarget(player) {
        const others = targets.filter(t => t !== player.target);
        player.target = others[Math.floor(Math.random() * others.length)];
    }

    function update() {
        if (!isPlaying) return;

        // Keyboard Controls
        if (keys['KeyA'] && p1.x > 0) p1.x -= 8;
        if (keys['KeyD'] && p1.x < canvas.width/2 - p1.w) p1.x += 8;
        if (keys['ArrowLeft'] && p2.x > canvas.width/2) p2.x -= 8;
        if (keys['ArrowRight'] && p2.x < canvas.width - p2.w) p2.x += 8;

        [p1, p2].forEach((p, idx) => {
            if (p.lives <= 0) return;
            
            p.timer++;
            if (p.timer > 800) { switchTarget(p); p.timer = 0; }

            // Spawn rate per level
            if (Math.random() < 0.01 + (currentLevel * 0.005)) {
                let min = idx === 0 ? 0 : canvas.width/2;
                let max = idx === 0 ? canvas.width/2 : canvas.width;
                spawnItem(p, min, max);
            }

            for (let i = p.items.length - 1; i >= 0; i--) {
                let it = p.items[i];
                it.y += it.speed;

                if (it.x < p.x + p.w && it.x + it.size > p.x && it.y < p.y + p.h && it.y + it.size > p.y) {
                    if (it.data.type === p.target) {
                        p.score += 10; AudioEngine.playCorrect();
                    } else {
                        p.lives--; AudioEngine.playWrong();
                    }
                    p.items.splice(i, 1);
                    document.getElementById(`scoreP${idx+1}`).innerText = p.score;
                    document.getElementById(`livesP${idx+1}`).innerText = "‚ù§Ô∏è".repeat(p.lives);
                    continue;
                }
                if (it.y > canvas.height) p.items.splice(i, 1);
            }
        });

        if (p1.lives <= 0 && p2.lives <= 0) endGame();
    }

    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        [p1, p2].forEach(p => {
            // Draw Basket
            ctx.fillStyle = p.color;
            ctx.beginPath();
            ctx.roundRect(p.x, p.y, p.w, p.h, 15);
            ctx.fill();
            ctx.fillStyle = "white"; ctx.textAlign = "center"; ctx.font = "bold 20px Arial";
            ctx.fillText("üì• " + p.label, p.x + p.w/2, p.y + 45);

            // Mission Badge (Melayang di atas keranjang)
            const badgeW = 140; const badgeY = p.y - 50;
            ctx.fillStyle = "rgba(255,255,255,0.9)";
            ctx.beginPath(); ctx.roundRect(p.x + (p.w/2 - badgeW/2), badgeY, badgeW, 35, 10); ctx.fill();
            ctx.fillStyle = "#333"; ctx.font = "bold 14px Arial";
            ctx.fillText("MISI: " + p.target, p.x + p.w/2, badgeY + 22);

            // Draw Items
            p.items.forEach(it => {
                ctx.save();
                ctx.shadowBlur = 10; ctx.shadowColor = it.data.color;
                ctx.beginPath(); ctx.arc(it.x + it.size/2, it.y + it.size/2, it.size/2, 0, Math.PI*2);
                ctx.fillStyle = "white"; ctx.fill();
                ctx.strokeStyle = it.data.color; ctx.lineWidth = 3; ctx.stroke();
                ctx.fillStyle = "black"; ctx.font = "bold 14px Arial";
                ctx.fillText(it.data.name, it.x + it.size/2, it.y + it.size/2 + 5);
                ctx.restore();
            });
        });

        if (isPlaying) requestAnimationFrame(draw);
    }

    function startGame(lvl) {
        currentLevel = lvl;
        document.getElementById('startScreen').classList.add('hidden');
        isPlaying = true; AudioEngine.ctx.resume();
        updateInterval = setInterval(update, 1000/60);
        draw();
    }

    function endGame() {
        isPlaying = false; clearInterval(updateInterval);
        document.getElementById('gameOverScreen').classList.remove('hidden');
        document.getElementById('finalScoreP1').innerText = p1.score;
        document.getElementById('finalScoreP2').innerText = p2.score;
        let winMsg = p1.score > p2.score ? "PEMAIN 1 MENANG! üèÜ" : (p2.score > p1.score ? "PEMAIN 2 MENANG! üèÜ" : "SERI! ü§ù");
        document.getElementById('winnerTitle').innerText = winMsg;
    }

    function toggleMute() { AudioEngine.muted = !AudioEngine.muted; document.querySelector('.mute-btn').innerText = AudioEngine.muted ? "üîá" : "üîä"; }
</script>
</body>
</html>
