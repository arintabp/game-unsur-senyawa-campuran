<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kimia Catcher: Swipe Edition</title>
    <style>
        body { margin: 0; overflow: hidden; background: #2c3e50; font-family: 'Segoe UI', sans-serif; touch-action: none; }
        
        /* UI LAYERS */
        #gameCanvas { display: block; width: 100%; height: 100vh; cursor: crosshair; }
        
        .ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; display: flex; flex-direction: column; }
        
        /* HEADER INFO */
        .header { padding: 15px; display: flex; justify-content: space-between; color: white; font-weight: bold; font-size: 1.2em; text-shadow: 2px 2px 0 #000; z-index: 10; }
        
        /* TARGET BOX */
        .target-box { 
            align-self: center; 
            margin-top: 10px; 
            padding: 10px 30px; 
            background: rgba(255, 255, 255, 0.9); 
            border-radius: 50px; 
            border: 4px solid #f1c40f; 
            text-align: center; 
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
            transition: transform 0.3s;
        }
        .target-label { font-size: 0.8em; color: #7f8c8d; letter-spacing: 2px; text-transform: uppercase; }
        .target-text { font-size: 1.8em; font-weight: 900; color: #2c3e50; margin: 0; }
        .pulse { animation: pulse 0.5s infinite alternate; }
        @keyframes pulse { from { transform: scale(1); } to { transform: scale(1.1); } }

        /* SCREENS */
        .modal { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.85); 
            display: flex; flex-direction: column; justify-content: center; align-items: center; 
            pointer-events: auto; z-index: 20; color: white; text-align: center;
        }
        .hidden { display: none !important; }
        
        button { 
            padding: 15px 40px; font-size: 1.5em; border: none; border-radius: 50px; 
            background: #27ae60; color: white; cursor: pointer; font-weight: bold; 
            box-shadow: 0 5px 0 #219150; margin-top: 20px; transition: 0.2s; 
        }
        button:active { transform: translateY(5px); box-shadow: none; }
        button:hover { background: #2ecc71; }

        /* TOMBOL MUTE */
        .mute-btn { position: absolute; bottom: 20px; right: 20px; z-index: 30; background: transparent; border: none; font-size: 1.5em; cursor: pointer; pointer-events: auto; }

        /* INSTRUKSI GESER */
        .drag-hint {
            position: absolute; bottom: 20%; width: 100%; text-align: center;
            color: rgba(255,255,255,0.5); font-size: 1.2em; animation: fadeBlink 2s infinite;
        }
        @keyframes fadeBlink { 0%,100% {opacity: 0.3} 50% {opacity: 0.8} }

    </style>
</head>
<body>

    <canvas id="gameCanvas"></canvas>

    <div class="ui-layer">
        <div class="header">
            <div>‚ù§Ô∏è <span id="livesDisplay">3</span></div>
            <div>üèÜ <span id="scoreDisplay">0</span></div>
        </div>
        
        <div id="targetBox" class="target-box">
            <div class="target-label">MISI: TANGKAP</div>
            <div id="targetText" class="target-text">UNSUR</div>
        </div>

        <div id="dragHint" class="drag-hint">üëà Geser jari/mouse untuk bergerak üëâ</div>
    </div>

    <div id="startScreen" class="modal">
        <h1 style="font-size: 3em; margin-bottom: 0; color: #f1c40f;">KIMIA CATCHER</h1>
        <p>Unsur, Senyawa, atau Campuran?</p>
        <div style="font-size: 0.9em; max-width: 400px; line-height: 1.5; color: #bdc3c7; margin-bottom: 20px;">
            Gerakkan keranjang dengan <b>menggeser jari/mouse</b>.<br>
            Tangkap zat yang sesuai dengan MISI!
        </div>
        <button onclick="startGame()">MULAI MAIN ‚ñ∂Ô∏è</button>
    </div>

    <div id="gameOverScreen" class="modal hidden">
        <h1 style="color: #e74c3c;">GAME OVER</h1>
        <p>Skor Akhir Kamu:</p>
        <h2 style="font-size: 4em; margin: 10px 0;" id="finalScore">0</h2>
        <button onclick="startGame()">MAIN LAGI üîÑ</button>
    </div>

    <button class="mute-btn" onclick="toggleMute()">üîä</button>

<script>
    // --- DATABASE ---
    const substances = [
        { name: "Emas", formula: "Au", type: "UNSUR", color: "#f1c40f" },
        { name: "Oksigen", formula: "O2", type: "UNSUR", color: "#3498db" },
        { name: "Besi", formula: "Fe", type: "UNSUR", color: "#95a5a6" },
        { name: "Karbon", formula: "C", type: "UNSUR", color: "#34495e" },
        { name: "Helium", formula: "He", type: "UNSUR", color: "#e74c3c" },
        { name: "Air", formula: "H2O", type: "SENYAWA", color: "#2980b9" },
        { name: "Garam", formula: "NaCl", type: "SENYAWA", color: "#ecf0f1" },
        { name: "Gula", formula: "C12H22O11", type: "SENYAWA", color: "#f39c12" },
        { name: "Karbon Dioksida", formula: "CO2", type: "SENYAWA", color: "#7f8c8d" },
        { name: "Asam Cuka", formula: "CH3COOH", type: "SENYAWA", color: "#d35400" },
        { name: "Udara", formula: "", type: "CAMPURAN", color: "#bdc3c7" },
        { name: "Air Laut", formula: "", type: "CAMPURAN", color: "#1abc9c" },
        { name: "Perunggu", formula: "", type: "CAMPURAN", color: "#d35400" },
        { name: "Tanah", formula: "", type: "CAMPURAN", color: "#8e44ad" },
        { name: "Susu", formula: "", type: "CAMPURAN", color: "#fff" }
    ];

    const targets = ["UNSUR", "SENYAWA", "CAMPURAN"];

    // --- VARIABLES ---
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    
    let score = 0;
    let lives = 3;
    let isPlaying = false;
    let currentTarget = "UNSUR";
    let targetTimer = 0;
    let speedMultiplier = 1;
    
    const player = { x: 0, y: 0, width: 100, height: 60 };
    let items = [];
    let particles = [];
    let spawnTimer = 0;

    // --- AUDIO ---
    const AudioEngine = {
        ctx: new (window.AudioContext || window.webkitAudioContext)(),
        muted: false,
        playTone: function(freq, type, duration) {
            if(this.muted || this.ctx.state === 'suspended') this.ctx.resume();
            if(this.muted) return;
            const osc = this.ctx.createOscillator();
            const gain = this.ctx.createGain();
            osc.type = type;
            osc.frequency.setValueAtTime(freq, this.ctx.currentTime);
            gain.gain.setValueAtTime(0.1, this.ctx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime + duration);
            osc.connect(gain); gain.connect(this.ctx.destination);
            osc.start(); osc.stop(this.ctx.currentTime + duration);
        },
        playCorrect: function() { this.playTone(600, 'sine', 0.2); setTimeout(()=>this.playTone(900, 'sine', 0.4), 100); },
        playWrong: function() { this.playTone(150, 'sawtooth', 0.4); },
        playSwitch: function() { this.playTone(400, 'square', 0.1); setTimeout(()=>this.playTone(400, 'square', 0.1), 150); }
    };

    // --- INPUT HANDLER (TOUCH & MOUSE) ---
    // Fungsi untuk mengupdate posisi keranjang
    function updatePlayerPosition(clientX) {
        if (!isPlaying) return;
        const rect = canvas.getBoundingClientRect();
        // Hitung posisi X mouse/jari relatif terhadap canvas
        let newX = clientX - rect.left - (player.width / 2);
        
        // Batasi agar tidak keluar layar (Clamping)
        if (newX < 0) newX = 0;
        if (newX > canvas.width - player.width) newX = canvas.width - player.width;
        
        player.x = newX;
    }

    // Mouse Movement
    canvas.addEventListener('mousemove', (e) => {
        updatePlayerPosition(e.clientX);
    });

    // Touch Movement (HP/Tablet)
    canvas.addEventListener('touchmove', (e) => {
        e.preventDefault(); // Mencegah layar ikut tergeser (scroll)
        updatePlayerPosition(e.touches[0].clientX);
    }, { passive: false });

    // --- RESIZE ---
    function resize() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        player.y = canvas.height - 100;
        if(player.x > canvas.width - player.width) player.x = canvas.width - player.width;
    }
    window.addEventListener('resize', resize);
    resize();
    player.x = canvas.width / 2 - player.width / 2;

    // --- GAME LOGIC ---
    function spawnItem() {
        const sub = substances[Math.floor(Math.random() * substances.length)];
        const size = 50;
        const x = Math.random() * (canvas.width - size);
        
        // KECEPATAN: Diperlambat (Base speed turun dari 2 ke 1.5)
        const baseSpeed = 1.5 + (Math.random() * 1.5); 
        
        items.push({
            x: x,
            y: -60,
            size: size,
            data: sub,
            speed: baseSpeed * speedMultiplier
        });
    }

    function createExplosion(x, y, color) {
        for(let i=0; i<15; i++) {
            particles.push({ x: x, y: y, vx: (Math.random()-0.5)*10, vy: (Math.random()-0.5)*10, life: 1.0, color: color });
        }
    }

    function switchTarget() {
        const newTarget = targets[Math.floor(Math.random() * targets.length)];
        if (newTarget === currentTarget) { switchTarget(); return; }
        currentTarget = newTarget;
        
        const box = document.getElementById('targetBox');
        const text = document.getElementById('targetText');
        box.classList.add('pulse'); setTimeout(() => box.classList.remove('pulse'), 1000);
        text.innerText = currentTarget;
        
        if(currentTarget === 'UNSUR') text.style.color = "#e67e22";
        if(currentTarget === 'SENYAWA') text.style.color = "#2980b9";
        if(currentTarget === 'CAMPURAN') text.style.color = "#27ae60";
        AudioEngine.playSwitch();
    }

    function update() {
        if (!isPlaying) return;

        // Difficulty (Naik pelan-pelan)
        speedMultiplier = 1 + (score * 0.01); 
        
        targetTimer++;
        if (targetTimer > 600) { switchTarget(); targetTimer = 0; }

        spawnTimer++;
        if (spawnTimer > 70) { // Spawn lebih jarang sedikit
            spawnItem();
            spawnTimer = 0 - (score * 1.5); 
        }

        // Items Logic
        for (let i = items.length - 1; i >= 0; i--) {
            let item = items[i];
            item.y += item.speed;

            // Collision
            if (
                item.x < player.x + player.width &&
                item.x + item.size > player.x &&
                item.y < player.y + player.height &&
                item.y + item.size > player.y
            ) {
                if (item.data.type === currentTarget) {
                    score += 10;
                    createExplosion(item.x, item.y, '#2ecc71');
                    AudioEngine.playCorrect();
                } else {
                    lives--;
                    createExplosion(item.x, item.y, '#e74c3c');
                    AudioEngine.playWrong();
                    document.body.style.background = "#c0392b";
                    setTimeout(() => document.body.style.background = "#2c3e50", 100);
                }
                items.splice(i, 1);
                updateUI();
                continue;
            }

            if (item.y > canvas.height) items.splice(i, 1);
        }

        // Particles
        for (let i = particles.length - 1; i >= 0; i--) {
            let p = particles[i];
            p.x += p.vx; p.y += p.vy; p.life -= 0.05;
            if (p.life <= 0) particles.splice(i, 1);
        }

        if (lives <= 0) endGame();
    }

    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // Player
        ctx.fillStyle = "#34495e";
        ctx.fillRect(player.x, player.y, player.width, player.height);
        ctx.fillStyle = "#f1c40f";
        ctx.fillRect(player.x, player.y, player.width, 10);
        ctx.font = "30px Arial"; ctx.textAlign = "center";
        ctx.fillText("üóëÔ∏è", player.x + player.width/2, player.y + 40);

        // Items
        items.forEach(item => {
            ctx.beginPath();
            ctx.arc(item.x + item.size/2, item.y + item.size/2, item.size/2 + 5, 0, Math.PI*2);
            ctx.fillStyle = "white"; ctx.fill();
            ctx.lineWidth = 3; ctx.strokeStyle = item.data.color; ctx.stroke();

            ctx.fillStyle = "black"; ctx.font = "bold 14px Arial";
            ctx.fillText(item.data.name, item.x + item.size/2, item.y + item.size/2 - 5);
            if(item.data.formula) {
                ctx.font = "italic 12px Arial"; ctx.fillStyle = "#555";
                ctx.fillText(item.data.formula, item.x + item.size/2, item.y + item.size/2 + 15);
            }
        });

        // Particles
        particles.forEach(p => {
            ctx.globalAlpha = p.life; ctx.fillStyle = p.color;
            ctx.beginPath(); ctx.arc(p.x, p.y, 5, 0, Math.PI*2); ctx.fill();
            ctx.globalAlpha = 1.0;
        });

        requestAnimationFrame(() => { update(); draw(); });
    }

    function updateUI() {
        document.getElementById('scoreDisplay').innerText = score;
        document.getElementById('livesDisplay').innerText = "‚ù§Ô∏è".repeat(lives);
    }

    function startGame() {
        score = 0; lives = 3; items = []; particles = []; speedMultiplier = 1; currentTarget = "UNSUR";
        document.getElementById('targetText').innerText = currentTarget;
        document.getElementById('startScreen').classList.add('hidden');
        document.getElementById('gameOverScreen').classList.add('hidden');
        document.getElementById('dragHint').style.display = 'none';
        
        AudioEngine.ctx.resume();
        isPlaying = true;
        updateUI();
        draw();
    }

    function endGame() {
        isPlaying = false;
        document.getElementById('finalScore').innerText = score;
        document.getElementById('gameOverScreen').classList.remove('hidden');
    }

    function toggleMute() {
        AudioEngine.muted = !AudioEngine.muted;
        document.querySelector('.mute-btn').innerText = AudioEngine.muted ? "üîá" : "üîä";
    }

    draw();

</script>
</body>
</html>
